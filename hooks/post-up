#!/bin/sh

print_step() {
  printf "\n\033[1;34m==> %s\033[0m\n" "$1"
}

print_success() {
  printf "\033[1;32m✔ %s\033[0m\n" "$1"
}

print_error() {
  printf "\033[1;31m✖ %s\033[0m\n" "$1"
}

if [ -d "$HOME/.config/tmux/plugins/tpm" ]; then
  "$HOME/.config/tmux/plugins/tpm/bin/install_plugins"
fi

mkdir -p "$HOME"/.ssh
chmod 700 "$HOME"/.ssh
chmod 600 "$HOME"/.ssh/*
chown -R "$USER" "$HOME"/.ssh

ssh_keys=(
  "id_ed25519"
  "1000bulbs-sandbox-ed25519-kp"
  "1000bulbs-integration-ed25519-kp"
  "1000bulbs-qa-ed25519-kp"
  "1000bulbs-staging-ed25519-kp"
  "1000bulbs-production-ed25519-kp"
)

for key_file in "${ssh_keys[@]}"; do
  full_path="$HOME/.ssh/$key_file"

  if [[ -f "$full_path" ]]; then
    print_step "Found: $key_file — adding to keychain..."
    if ssh-add --apple-use-keychain "$full_path" 2>/dev/null; then
      print_success "$key_file added successfully."
    else
      print_error "Failed to add $key_file."
    fi
  else
    print_error "Key not found: $key_file"
  fi
done
